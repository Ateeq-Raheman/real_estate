{% extends "templates/estate_base.html" %}
{% block title%} Detail {% endblock %}

{% block content %}
<div class="site-blocks-cover inner-page-cover overlay" style="background-image: url({{property.image}});"
  data-aos="fade" data-stellar-background-ratio="0.5">
  <div class="container">
    <div class="row align-items-center justify-content-center text-center">
      <div class="col-md-10">
        <span class="d-inline-block text-white px-3 mb-3 property-offer-type rounded">Property Details of</span>
        <h1 class="mb-2">{{property.property_name}}</h1>
        <p class="mb-5"><strong class="h2 text-success font-weight-bold">
            <div>
              {{ frappe.format(property.grand_total, {'fieldtype': 'Currency'}) }}
            </div>
          </strong></p>
      </div>
    </div>
  </div>
</div>

<div class="site-section site-section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <div>
          <div class="slide-one-item home-slider owl-carousel">
            <div><img src="{{property.image}}" alt="Image" class="img-fluid"></div>
            <div><img src="{{property.image}}" alt="Image" class="img-fluid"></div>
            <div><img src="{{property.image}}" alt="Image" class="img-fluid"></div>
          </div>
        </div>
        <div class="bg-white property-body border-bottom border-left border-right">
          <div class="row mb-5">
            <div class="col-md-6">
              <!-- <strong class="text-success h1 mb-3"> -->
              <p>Raw Value: {{ property.grand_total }}</p>
              <div
                class="text-success h1 mb-3">{{ frappe.format_value(property.grand_total) }}</strong>
                <!-- class="text-success h1 mb-3">{{ frappe.format(property.grand_total, {'fieldtype': 'Currency'}) }}</strong> -->

              <!-- {{ frappe.format(property.grand_total, {'fieldtype': 'Currency' , 'options': 'USD'}) }} -->

            </div></strong>
          </div>
          <div class="col-md-6">
            <ul class="property-specs-wrap mb-3 mb-lg-0  float-lg-right">
              <li>
                <span class="property-specs">Beds</span>
                <span class="property-specs-number">2 <sup>+</sup></span>

              </li>
              <li>
                <span class="property-specs">Baths</span>
                <span class="property-specs-number">2</span>

              </li>
              <li>
                <span class="property-specs">SQ FT</span>
                <span class="property-specs-number">7,000</span>

              </li>
            </ul>
          </div>
        </div>
        <div class="row mb-5">
          <div class="col-md-6 col-lg-3 text-center border-bottom border-top py-3">
            <span class="d-inline-block text-black mb-0 caption-text">code</span>
            <strong class="d-block" id="property-name">{{property.name}}</strong>
          </div>
          <div class="col-md-6 col-lg-3 text-center border-bottom border-top py-3">
            <span class="d-inline-block text-black mb-0 caption-text">Home Type</span>
            <strong class="d-block">{{property.property_type}}</strong>
          </div>
          <div class="col-md-6 col-lg-3 text-center border-bottom border-top py-3">
            <span class="d-inline-block text-black mb-0 caption-text">For</span>
            <strong class="d-block">{{property.status}}</strong>
          </div>
          <div class="col-md-6 col-lg-3 text-center border-bottom border-top py-3">
            <span class="d-inline-block text-black mb-0 caption-text">Actual price</span>
            <strong class="d-block">{{ frappe.format(property.property_price, {'fieldtype': 'Currency','currency': 'INR'}) }}
          </div></strong>
        </div>
      </div>
      <h2 class="h4 text-black">More Info</h2>
      <p>{{property.description}}</p>

      <p>
      <div>
        <h4>
          <!-- <table class="table">
                <thead class="thead-dark">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                    <th scope="col">Handle</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>@twitter</td>
                  </tr>
                </tbody>
              </table> -->

          <table class="table">
            <thead class="thead-light">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Amenity</th>
                <th scope="col">Price</th>
                <th scope="col">Discount</th>
              </tr>
            </thead>
            <tbody>
              {% for amenity in property.amenity %}
              <tr>
                <th scope="row">{{ loop.index }}</th>
                <td>{{ amenity.amenity_name }}</td>
                <td>{{ frappe.format(amenity.amenity_price, {'fieldtype': 'Currency'}) }}</td>
                <td>{{ frappe.format(amenity.amenity_discount, {'fieldtype': 'Currency'}) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </h4>
      </div>
      </p>
    </div>
  </div>
  <div class="col-lg-4">

    <div class="bg-white widget border rounded">

      <h3 class="h4 text-black widget-title mb-3">Contact Agent</h3>
      <form action="" class="form-contact-agent">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" class="form-control" value="{{agent.name}}" disabled>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" class="form-control" value="{{agent.email}}" disabled>
        </div>
        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="text" id="phone" class="form-control" value="{{agent.phone}}" disabled>
        </div>
        <div class="form-group">
          <input type="button" id="agent_button" class="btn btn-primary" value="Contact Agent">
        </div>
      </form>
    </div>

    <!-- <div class="bg-white widget border rounded">
          <h3 class="h4 text-black widget-title mb-3">Paragraph</h3>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Velit qui explicabo, libero nam, saepe eligendi.
            Molestias maiores illum error rerum. Exercitationem ullam saepe, minus, reiciendis ducimus quis. Illo,
            quisquam, veritatis.</p>
        </div> -->

  </div>

</div>
</div>
</div>

<div class="site-section site-section-sm bg-light">
  <div class="container">

    <div class="row">
      <div class="col-12">
        <div class="site-section-title mb-5">
          <h2>Related Properties</h2>
        </div>
      </div>
    </div>

    <div class="row mb-5">
      {% for property in related_properties %}
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="property-entry h-100">
          <a href="property/detail/{{property.name}}" class="property-thumbnail">
            <div class="offer-type-wrap">
              <span class="offer-type bg-{% if property.status == " SALE" %}success{% elif property.status=="RENT"
                %}danger{% else %}warning{% endif %}">{{property.status}}</span>
            </div>
            <img src="{{property.image}}" alt="Image" class="img-fluid">
          </a>
          <div class="p-4 property-body">
            <a href="#" class="property-favorite"><span class="icon-heart-o"></span></a>
            <h2 class="property-title"><a href="property/detail/{{property.name}}">{{property.property_name}}</a></h2>
            <span class="property-location d-block mb-3"><span
                class="property-icon icon-room"></span>{{property.address}}</span>
            <strong
              class="property-price text-primary mb-3 d-block text-success">{{ frappe.format(property.grand_total, {'fieldtype': 'Currency'}) }}</strong>
            <ul class="property-specs-wrap mb-3 mb-lg-0">
              <li>
                <span class="property-specs">Beds</span>
                <span class="property-specs-number">2 <sup>+</sup></span>

              </li>
              <li>
                <span class="property-specs">Baths</span>
                <span class="property-specs-number">2</span>

              </li>
              <li>
                <span class="property-specs">SQ FT</span>
                <span class="property-specs-number">7,000</span>

              </li>
            </ul>

          </div>
        </div>
      </div>
      {% else %}
      <p>No properties found.</p>
      {% endfor %}
    </div>
  </div>

  {% endblock %}


  {% block script %}

  <!-- script of detail.js -->
  <!-- <script src="/real_estate/real_estate/public/www/js/detail.js"></script> -->
  <script>
    document.querySelector("#agent_button").addEventListener("click",
      (e) => {
        console.log("starting of the detail.js");

        let agent_email = document.querySelector("#email").value;
        let property_name = document.querySelector("#property-name").textContent;
        let d = new frappe.ui.Dialog({
          title: 'Enter details',
          fields: [
            {
              label: 'Your Name',
              fieldname: 'name',
              fieldtype: 'Data'
            },
            {
              label: 'Your email',
              fieldname: 'email',
              fieldtype: 'Data'
            },
            {
              label: 'Message',
              fieldname: 'message',
              fieldtype: 'Small Text'
            }
          ],
          primary_action_label: 'Submit',
          primary_action(values) {
            values.agent_email = agent_email;
            values.property_name = property_name;
            console.log(values);
            console.log("Hi before the frappe call");
            // api call whitelist method
            frappe.call({
              method: "real_estate.api.contact_agent", //dotted path to server method
              args: values,
              callback: function (r) {
                // code snippet
                console.log(r)
                console.log("HI FROM the frappe call of DETAIL.JS")
                frappe.msgprint({
                  msg: (r.message),
                  title: 'Notification',
                  indicator: "green"
                })


              }
            })
            d.hide();
          }
        });

        d.show();

      })

    // document.querySelector("#agent_button").addEventListener("click", () => console.log("clicked"))

  </script>

  <!-- end for detial.js -->

  {% endblock %}